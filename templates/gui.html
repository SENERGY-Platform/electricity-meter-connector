<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Ferraris Arduino Serial Gateway</title>
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
	<script src="{{ url_for('static', filename='gui.js') }}"></script>
</head>

<body>
<div class="wrapper">

	<header class="header">
		<div class="main-navigation">
			{% for device in devices %}
			{% if device == d_id %}
			<button class="btnactive" type="button" onclick="location.href=('{{ device }}');">Device {{ device }}</button>
			{% else %}
			<button class="btn" type="button" onclick="location.href=('{{ device }}');">Device {{ device }}</button>
			{% endif %}
			{% endfor %}
		</div>
    </header><!-- .header-->

	<div class="middle">

		<div class="container">
			<main id="content" class="content">

			</main><!-- .content -->
		</div><!-- .container-->

		<aside class="left-sidebar">
			<div class="sub-navigation">
				{% if d_id %}
				<button class="btn" type="button" id="myBtn">Configure</button>
				<button class="btn" type="button" onclick="httpPost('{{ d_id }}/rs')">Read Sensor</button>
				<button class="btn" type="button" onclick="httpPost('{{ d_id }}/dbg')">Debug Mode</button>
				<button class="btn" type="button" onclick="httpPost('{{ d_id }}/strt')">Start Detection</button>
				<button class="btn" type="button" onclick="httpPost('{{ d_id }}/stp')">Stop Current Action</button>
				<button class="btn" type="button" onclick="httpPost('{{ d_id }}/res')">Reset</button>
				Auto Start
				<label class="switch">
					<input id="astrt" type="checkbox" onclick="toggleAstrt(this)">
					<span class="slider"></span>
				</label>
				<script>openWS();</script>
				{% endif %}
			</div>
		</aside><!-- .left-sidebar -->

	</div><!-- .middle-->

</div><!-- .wrapper -->

<footer class="footer">
	<img id="logo" src="{{ url_for('static', filename='logo.svg') }}">
</footer><!-- .footer -->

<div id="myModal" class="modal">

  <!-- Modal content -->
	<div class="modal-content">
		<span class="close">OK</span>
		<label for="nat">New Average Threshold: </label><input id="nat" type="number" min="0" max="100000" required>
		<label for="dt">Detection Threshold: </label><input id="dt" type="number" min="0" max="100000" required>
		<label for="lld">Lower Limit Distance: </label><input id="lld" type="number" min="0" max="100000" required>
		<label for="rpkwh">Rotations / kWh: </label><input id="rpkwh" type="number" min="0" max="100000" required>
		<label for="tkwh">Total kWh: </label><input id="tkwh" type="text" required>
	</div>

</div>

<script>
	httpGetConf('{{ d_id }}/conf');
    var modal = document.getElementById('myModal');
    var btn = document.getElementById("myBtn");
    var span = document.getElementsByClassName("close")[0];
    btn.onclick = function() {
        httpGetConf('{{ d_id }}/conf');
        modal.style.display = "block";
    };
    span.onclick = function() {
        var nat = document.getElementById("nat");
        var dt = document.getElementById("dt");
        var lld = document.getElementById("lld");
        var rpkwh = document.getElementById("rpkwh");
        var tkwh = document.getElementById("tkwh");
        if (nat.checkValidity()) {
            if (dt.checkValidity()) {
                if (lld.checkValidity()) {
                    if (rpkwh.checkValidity()) {
                        if (tkwh.checkValidity()) {
                            httpPostConf('{{ d_id }}/conf', nat.value, dt.value, lld.value, rpkwh.value, tkwh.value);
							modal.style.display = "none";
                        } else {
                            tkwh.value = '';
						}
					} else {
                        rpkwh.value = '';
					}
                } else {
                    lld.value = '';
				}
            } else {
                dt.value = '';
			}
        } else {
            nat.value = '';
		}
    };
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>